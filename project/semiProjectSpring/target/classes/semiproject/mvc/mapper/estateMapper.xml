<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="estate">
 
 	<insert id="addproduct" parameterType="evo">
 		insert into product values(product_seq.nextVal,#{anum},#{build},#{floor},#{supply},#{exclusive},#{title},null,null)
 	</insert>
 	<insert id="addproductsale" parameterType="rentvo">
 		insert into product_sale_info values(product_sale_info_seq.nextVal,#{pdnum},#{rentv},#{rpay},#{dan})
 	</insert>
 	<insert id="addproductinfo" parameterType="aivo">
 		insert into product_info values(product_info_seq.nextVal,#{pdnum},#{aspay},#{pets},#{park},#{ppay},#{elevator},#{balcony},#{built},#{pstructure}, #{chartered},#{pmove},#{heating},#{description}  )
 	</insert>
 	<insert id="addadmin" parameterType="adminvo">
 		insert into administrative values(administrative_seq.nextVal,#{pidnum},#{administrat})
 	</insert>
 	<insert id="addoptionsel" parameterType="osvo" >
 		insert into option_sel values(option_sel_seq.nextVal,#{pidnum},#{option})
 	</insert>
 
 
 	<select id="productnum" parameterType="evo" resultType="int">
 		select pdnum from product where anum=#{anum} and ATCLFETRDESC=#{title} 
 	</select>
 	<select id="productinfonum" parameterType="int" resultType="int">
 		select pidnum from product_info where pdnum=#{pdnum}
 	</select>

 	
 <select id="pcount" resultType="int">
  select count(*) cnt from product
 </select>
 	<!-- 메인페이지 리스트  -->
 	<select id="estatemlist" resultMap="mlist" parameterType="epvo">
 		select * from (
			select rownum r_num, a.* from
			(
				select p.pdnum pdnum,p.rlettpcd rlettpcd,p.spc1 spc1,p.spc2 spc2,p.atclfetrdesc atclfetrdesc,ps.prnum prnum,ps.tradtpcd tradtpcd, ps.prc prc from product p, product_sale_info ps where p.pdnum=ps.pdnum 
				and p.rlettpcd not in('E03','D01','D02','E02','C02','A03','D04','E04')
			order by p.pdnum desc
		) a
		) where r_num between #{start} and #{end} 
 	</select>
 	
 	<resultMap type="evo" id="mlist">
 		<id property="pdnum" column="pdnum"/>
 		<result property="build" column="rlettpcd"/>
 		<result property="supply" column="spc1"/>
 		<result property="exclusive" column="spc2"/>
 		<result property="title" column="atclfetrdesc"/>
 		<collection property="rent" javaType="java.util.List" resultMap="rentm" ofType="rentvo" />
 	</resultMap>
 	<resultMap type="rentvo" id="rentm">
 		<id column="prnum" property="prnum"/>
 		<result property="rentv" column="tradtpcd"/>
 		<result property="rpay" column="prc"/>
 	</resultMap>
 	
 	<resultMap type="evo" id="detail">
 		<id property="pdnum" column="pdnum"/>
 		<result property="build" column="rlettpcd"/>
 		<result property="floor" column="flrinfo"/>
 		<result property="supply" column="spc1"/>
 		<result property="exclusive" column="spc2"/>
 		<result property="title" column="atclfetrdesc"/>
 		<result property="plocation" column="plocation"/>
 		<association property="addinfo" column="pdnum"  javaType="aivo">
 			<id property="pidnum" column="pidnum"/>
 			<result property="aspay" column="aspay"/>
 			<result property="pets" column="pets"/>
 			<result property="park" column="parking"/>
 			<result property="ppay" column="ppay"/>
 			<result property="elevator" column="elevator"/>
 			<result property="balcony" column="balcony"/>
 			<result property="built" column="built"/>
 			<result property="pstructure" column="pstructure"/>
 			<result property="chartered" column="chartered"/>
 			<result property="pmove" column="pmove"/>
 			<result property="heating" column="heating"/>
 			<result property="description" column="pdescription"/>
 			<collection property="administrative" javaType="java.util.List" resultMap="adminlist" ofType="adminvo"/>
 			<collection property="poption" javaType="java.util.List" resultMap="optionlist" ofType="osvo"/>
 		</association>
 		<collection property="rent" javaType="java.util.List" resultMap="rentm" ofType="rentvo" />
 		
 	</resultMap>
 	<resultMap type="adminvo" id="adminlist">
 		<id property="adnum" column="adnum"/>
 		<result property="administrat" column="item"/>
 	
 	</resultMap>
 	<resultMap type="osvo" id="optionlist">
 		<id property="osnum" column="osnum" />
 		<result property="option" column="poption"/>
 	</resultMap>
 	
 	<!-- 디테일  -->
 	<select id="Detail" resultMap="detail" parameterType="int" >
 		select p.pdnum pdnum, p.rlettpcd rlettpcd , p.flrinfo flrinfo, p.spc1 spc1,p.spc2 spc2,
 		p.atclfetrdesc atclfetrdesc , pl.plocation plocation ,ps.prnum prnum, ps.tradtpcd tradtpcd, ps.prc prc,
 		 pi.pidnum pidnum,pi.aspay aspay,pi.pets pets,pi.parking parking, pi.ppay ppay,pi.elevator elevator, pi.balcony balcony,
 		  pi.built built, pi.pstructure pstructure,pi.chartered chartered, pi.pmove pmove,pi.heating heating , ad.item item,ad.adnum adnum,os.poption poption,os.osnum osnum,pi.PDESCRIPTION pdescription
 	
 		from product p , product_info pi,product_sale_info ps,product_location pl,administrative ad,option_sel os
 		 where p.pdnum=#{num} and p.pdnum=pl.pdnum and p.pdnum=ps.pdnum and p.pdnum=pi.pdnum and pi.pidnum=ad.pidnum and pi.pidnum=os.pidnum
 	</select>
 	
 	
 </mapper>